<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Syrian Equipment Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .modal-overlay { background: rgba(0,0,0,0.4); }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 p-4">
  <div class="max-w-6xl mx-auto" id="app">
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <div class="flex items-center gap-3">
          <h1 class="text-2xl font-bold text-gray-800">Syrian Equipment Tracker</h1>
          <button id="adminToggle" onclick="handleAdminToggle()" class="flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-500 hover:bg-gray-200">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
            <span id="adminToggleText">Viewer</span>
          </button>
        </div>
        <p class="text-gray-500 text-sm"><span id="itemCount">0</span> items tracked</p>
        <div class="flex gap-3 text-xs text-gray-400 mt-1">
          <span><b>IMV</b> Infantry Mobility Vehicle</span>
          <span><b>APC</b> Armored Personnel Carrier</span>
          <span><b>MBT</b> Main Battle Tank</span>
        </div>
      </div>
      <div id="adminButtons" class="hidden gap-2">
        <button onclick="showImportModal()" class="flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 hover:bg-gray-50 rounded-lg text-sm shadow-sm">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
          Import
        </button>
        <button onclick="showAddModal()" class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm shadow-sm">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          Add Entry
        </button>
      </div>
    </div>

    <!-- Search & Filter -->
    <div class="flex gap-3 mb-4">
      <div class="relative flex-1">
        <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
        <input id="searchInput" oninput="renderTable()" placeholder="Search equipment..." class="w-full pl-10 pr-4 py-2 bg-white border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-gray-300 shadow-sm">
      </div>
      <select id="categoryFilter" onchange="renderTable()" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm focus:outline-none shadow-sm">
        <option value="All">All</option>
        <option value="IMV">IMV</option>
        <option value="APC">APC</option>
        <option value="MBT">MBT</option>
        <option value="Artillery">Artillery</option>
        <option value="Small Arms">Small Arms</option>
        <option value="Aircraft">Aircraft</option>
        <option value="Helicopter">Helicopter</option>
      </select>
    </div>

    <!-- Table -->
    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
      <table class="w-full text-sm">
        <thead class="bg-gray-50">
          <tr class="border-b border-gray-200">
            <th class="text-left p-3 font-medium text-gray-600 text-sm">Img</th>
            <th class="text-left p-3 font-medium text-gray-600 text-sm">Equipment</th>
            <th class="text-left p-3 font-medium text-gray-600 text-sm">Category</th>
            <th class="text-left p-3 font-medium text-gray-600 text-sm">Qty</th>
            <th class="text-left p-3 font-medium text-gray-600 text-sm">Status</th>
            <th class="text-left p-3 font-medium text-gray-600 text-sm">Operator</th>
            <th class="text-left p-3 font-medium text-gray-600 text-sm">Notes</th>
            <th class="p-3 admin-only hidden"></th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Password Modal -->
  <div id="passwordModal" class="fixed inset-0 modal-overlay hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-sm border border-gray-200 shadow-lg">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-gray-800">Admin Access</h2>
        <button onclick="closePasswordModal()" class="text-gray-400 hover:text-gray-600">&times;</button>
      </div>
      <p class="text-gray-500 text-sm mb-4">Enter password to access admin mode</p>
      <input type="password" id="passwordInput" onkeydown="if(event.key==='Enter')checkPassword()" placeholder="Password" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none mb-2">
      <p id="passwordError" class="text-red-500 text-xs mb-2 hidden">Incorrect password</p>
      <div class="flex justify-end gap-2 mt-4">
        <button onclick="closePasswordModal()" class="px-4 py-2 text-gray-500 hover:text-gray-700">Cancel</button>
        <button onclick="checkPassword()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg">Unlock</button>
      </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="fixed inset-0 modal-overlay hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-2xl border border-gray-200 shadow-lg">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-gray-800">Import Data</h2>
        <button onclick="closeImportModal()" class="text-gray-400 hover:text-gray-600">&times;</button>
      </div>
      <p class="text-gray-500 text-sm mb-3">Paste tab-separated or CSV data. Expected columns: Name, Category, Quantity, Status, Operator, Notes, Image URL</p>
      <textarea id="importText" placeholder="T-72AV&#9;MBT&#9;150&#9;Active&#9;Syrian Arab Army&#9;Main battle tank" class="w-full h-48 p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm font-mono focus:outline-none focus:border-gray-300 mb-4"></textarea>
      <div class="flex justify-end gap-2">
        <button onclick="closeImportModal()" class="px-4 py-2 text-gray-500 hover:text-gray-700">Cancel</button>
        <button onclick="parseImport()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg">Import</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Modal -->
  <div id="editModal" class="fixed inset-0 modal-overlay hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-md border border-gray-200 shadow-lg">
      <div class="flex justify-between items-center mb-4">
        <h2 id="editModalTitle" class="text-lg font-semibold text-gray-800">Add Equipment</h2>
        <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600">&times;</button>
      </div>
      <div class="space-y-3">
        <input id="editName" placeholder="Equipment name" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:border-gray-300">
        <div class="grid grid-cols-2 gap-3">
          <select id="editCategory" class="p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm">
            <option>IMV</option><option>APC</option><option>MBT</option><option>Artillery</option><option>Small Arms</option><option>Aircraft</option><option>Helicopter</option>
          </select>
          <input id="editQuantity" placeholder="Quantity" class="p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none">
        </div>
        <div class="grid grid-cols-2 gap-3">
          <select id="editStatus" class="p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm">
            <option>Active</option><option>Destroyed</option><option>Captured</option><option>Abandoned</option><option>Unknown</option>
          </select>
          <select id="editOperator" class="p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm">
            <option>Syrian Arab Army</option><option>Republican Guard</option><option>Air Force</option><option>4th Division</option><option>Tiger Forces</option><option>NDF</option><option>Other</option>
          </select>
        </div>
        <textarea id="editNotes" placeholder="Notes (optional)" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none h-20"></textarea>
        <input id="editImage" placeholder="Image URL (optional)" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none">
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button onclick="closeEditModal()" class="px-4 py-2 text-gray-500 hover:text-gray-700">Cancel</button>
        <button onclick="saveItem()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg">Save</button>
      </div>
    </div>
  </div>

  <!-- Image Viewer Modal -->
  <div id="imageModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center p-4 z-50" onclick="closeImageModal()">
    <div class="relative max-w-4xl max-h-[90vh]">
      <button onclick="closeImageModal()" class="absolute -top-10 right-0 text-white hover:text-gray-300 text-2xl">&times;</button>
      <img id="imageModalImg" class="max-w-full max-h-[85vh] object-contain rounded-lg" src="" alt="">
    </div>
  </div>

  <script>
    // Config
    const ADMIN_PASSWORD = 'syria2024'; // Change this
    const STORAGE_KEY = 'syrian_equipment_data';

    // State
    let equipment = [];
    let isAdmin = false;
    let editingId = null;

    // Storage
    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(equipment));
    }

    function loadData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        equipment = JSON.parse(saved);
      }
      renderTable();
    }

    // Status colors
    function getStatusClasses(status) {
      const colors = {
        'Active': 'bg-green-100 text-green-700',
        'Destroyed': 'bg-red-100 text-red-700',
        'Captured': 'bg-amber-100 text-amber-700',
        'Abandoned': 'bg-gray-200 text-gray-600',
        'Unknown': 'bg-slate-100 text-slate-600'
      };
      return colors[status] || colors['Unknown'];
    }

    // Render
    function renderTable() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;
      
      const filtered = equipment.filter(item => {
        const matchSearch = item.name.toLowerCase().includes(search) || item.notes.toLowerCase().includes(search);
        const matchCat = category === 'All' || item.category === category;
        return matchSearch && matchCat;
      });

      document.getElementById('itemCount').textContent = equipment.length;

      const tbody = document.getElementById('tableBody');
      if (filtered.length === 0) {
        tbody.innerHTML = `<tr><td colspan="${isAdmin ? 8 : 7}" class="p-8 text-center text-gray-400">No equipment found</td></tr>`;
        return;
      }

      tbody.innerHTML = filtered.map(item => `
        <tr class="border-b border-gray-100 hover:bg-gray-50">
          <td class="p-3">
            ${item.image ? 
              `<img src="${item.image}" onclick="viewImage('${item.image}')" class="w-10 h-10 object-cover rounded cursor-pointer hover:opacity-80" onerror="this.style.display='none'" alt="">` :
              `<div class="w-10 h-10 bg-gray-100 rounded flex items-center justify-center"><svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg></div>`
            }
          </td>
          <td class="p-3 font-medium text-gray-800">${item.name}</td>
          <td class="p-3 text-gray-600">${item.category}</td>
          <td class="p-3 text-gray-600">${item.quantity}</td>
          <td class="p-3"><span class="px-2 py-1 rounded text-xs font-medium ${getStatusClasses(item.status)}">${item.status}</span></td>
          <td class="p-3 text-gray-600">${item.operator}</td>
          <td class="p-3 text-gray-500 max-w-xs truncate">${item.notes}</td>
          ${isAdmin ? `
            <td class="p-3">
              <div class="flex gap-1">
                <button onclick="editItem(${item.id})" class="p-1 text-gray-400 hover:text-blue-500">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                </button>
                <button onclick="deleteItem(${item.id})" class="p-1 text-gray-400 hover:text-red-500">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
              </div>
            </td>
          ` : ''}
        </tr>
      `).join('');
    }

    // Admin toggle
    function handleAdminToggle() {
      if (isAdmin) {
        isAdmin = false;
        updateAdminUI();
      } else {
        document.getElementById('passwordModal').classList.remove('hidden');
        document.getElementById('passwordModal').classList.add('flex');
        document.getElementById('passwordInput').focus();
      }
    }

    function checkPassword() {
      const input = document.getElementById('passwordInput');
      if (input.value === ADMIN_PASSWORD) {
        isAdmin = true;
        closePasswordModal();
        updateAdminUI();
      } else {
        document.getElementById('passwordError').classList.remove('hidden');
        input.classList.add('border-red-300', 'bg-red-50');
      }
    }

    function closePasswordModal() {
      document.getElementById('passwordModal').classList.add('hidden');
      document.getElementById('passwordModal').classList.remove('flex');
      document.getElementById('passwordInput').value = '';
      document.getElementById('passwordError').classList.add('hidden');
      document.getElementById('passwordInput').classList.remove('border-red-300', 'bg-red-50');
    }

    function updateAdminUI() {
      const toggle = document.getElementById('adminToggle');
      const toggleText = document.getElementById('adminToggleText');
      const adminButtons = document.getElementById('adminButtons');
      const adminCols = document.querySelectorAll('.admin-only');

      if (isAdmin) {
        toggle.className = 'flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-700';
        toggleText.textContent = 'Admin';
        adminButtons.classList.remove('hidden');
        adminButtons.classList.add('flex');
        adminCols.forEach(el => el.classList.remove('hidden'));
      } else {
        toggle.className = 'flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-500 hover:bg-gray-200';
        toggleText.textContent = 'Viewer';
        adminButtons.classList.add('hidden');
        adminButtons.classList.remove('flex');
        adminCols.forEach(el => el.classList.add('hidden'));
      }
      renderTable();
    }

    // Import
    function showImportModal() {
      document.getElementById('importModal').classList.remove('hidden');
      document.getElementById('importModal').classList.add('flex');
    }

    function closeImportModal() {
      document.getElementById('importModal').classList.add('hidden');
      document.getElementById('importModal').classList.remove('flex');
      document.getElementById('importText').value = '';
    }

    function parseImport() {
      const text = document.getElementById('importText').value.trim();
      const lines = text.split('\n');
      const categories = ['IMV', 'APC', 'MBT', 'Artillery', 'Small Arms', 'Aircraft', 'Helicopter'];
      const statuses = ['Active', 'Destroyed', 'Captured', 'Abandoned', 'Unknown'];
      let maxId = equipment.length > 0 ? Math.max(...equipment.map(e => e.id)) : 0;

      for (const line of lines) {
        if (!line.trim()) continue;
        const parts = line.split(/\t|,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(p => p.replace(/^"|"$/g, '').trim());
        if (parts.length >= 2) {
          maxId++;
          equipment.push({
            id: maxId,
            name: parts[0] || 'Unknown',
            category: categories.includes(parts[1]) ? parts[1] : 'IMV',
            quantity: parts[2] || '?',
            status: statuses.includes(parts[3]) ? parts[3] : 'Unknown',
            operator: parts[4] || 'Syrian Arab Army',
            notes: parts[5] || '',
            image: parts[6] || ''
          });
        }
      }
      saveData();
      renderTable();
      closeImportModal();
    }

    // Add/Edit
    function showAddModal() {
      editingId = null;
      document.getElementById('editModalTitle').textContent = 'Add Equipment';
      document.getElementById('editName').value = '';
      document.getElementById('editCategory').value = 'IMV';
      document.getElementById('editQuantity').value = '';
      document.getElementById('editStatus').value = 'Active';
      document.getElementById('editOperator').value = 'Syrian Arab Army';
      document.getElementById('editNotes').value = '';
      document.getElementById('editImage').value = '';
      document.getElementById('editModal').classList.remove('hidden');
      document.getElementById('editModal').classList.add('flex');
    }

    function editItem(id) {
      const item = equipment.find(e => e.id === id);
      if (!item) return;
      editingId = id;
      document.getElementById('editModalTitle').textContent = 'Edit Equipment';
      document.getElementById('editName').value = item.name;
      document.getElementById('editCategory').value = item.category;
      document.getElementById('editQuantity').value = item.quantity;
      document.getElementById('editStatus').value = item.status;
      document.getElementById('editOperator').value = item.operator;
      document.getElementById('editNotes').value = item.notes;
      document.getElementById('editImage').value = item.image || '';
      document.getElementById('editModal').classList.remove('hidden');
      document.getElementById('editModal').classList.add('flex');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.add('hidden');
      document.getElementById('editModal').classList.remove('flex');
      editingId = null;
    }

    function saveItem() {
      const name = document.getElementById('editName').value.trim();
      if (!name) return;

      const item = {
        name,
        category: document.getElementById('editCategory').value,
        quantity: document.getElementById('editQuantity').value,
        status: document.getElementById('editStatus').value,
        operator: document.getElementById('editOperator').value,
        notes: document.getElementById('editNotes').value,
        image: document.getElementById('editImage').value
      };

      if (editingId) {
        const idx = equipment.findIndex(e => e.id === editingId);
        if (idx !== -1) {
          equipment[idx] = { ...item, id: editingId };
        }
      } else {
        const maxId = equipment.length > 0 ? Math.max(...equipment.map(e => e.id)) : 0;
        equipment.push({ ...item, id: maxId + 1 });
      }

      saveData();
      renderTable();
      closeEditModal();
    }

    function deleteItem(id) {
      equipment = equipment.filter(e => e.id !== id);
      saveData();
      renderTable();
    }

    // Image viewer
    function viewImage(src) {
      document.getElementById('imageModalImg').src = src;
      document.getElementById('imageModal').classList.remove('hidden');
      document.getElementById('imageModal').classList.add('flex');
    }

    function closeImageModal() {
      document.getElementById('imageModal').classList.add('hidden');
      document.getElementById('imageModal').classList.remove('flex');
    }

    // Init
    loadData();
  </script>
</body>
</html>
